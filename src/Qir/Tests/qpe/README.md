# Structure
See https://github.com/cgranade/qpe-for-pnnl  

The `qsharp` folder from there was copied to here and the work-around fixes were applied to `.\qsharp\Program.qs`.  
The `.\qsharp\est-energy.csproj` refers the version `0.24.39585-alpha` (artifacts are [here](https://dev.azure.com/ms-quantum-public/Microsoft%20Quantum%20(public)/_build/results?buildId=39585&view=artifacts&pathAsName=false&type=publishedArtifacts), at `drop/drops/nugets`) that has a [Q# compiler fix](https://github.com/microsoft/qsharp-compiler/pull/1373). Or you can get the latest [Q# compiler](https://github.com/microsoft/qsharp-compiler), build it and use it.

The QIR is generated by `.\build.ps1` as `.\qsharp\qir\est-energy.ll`.  
If you don't have the Q# comiler version `0.24.39585-alpha` then the generation of the `.\qsharp\qir\est-energy.ll` will fail, but a copy of it is available as `.\est-energy.ll`. The compilation will continue.
The QAT tool, [this patch](https://github.com/qir-alliance/qat/pull/66), has been applied to `.\qsharp\qir\est-energy.ll` in order to add the debugging information to the .ll file. The result is `.\est-energy.qat.dbginfo.ll`.

The `py_out.json` has been generated from [Quantum/samples/chemistry/IntegralData/Broombridge_v0.2/LiH_sto-3g.yaml](https://github.com/microsoft/Quantum/blob/main/samples/chemistry/IntegralData/Broombridge_v0.2/LiH_sto-3g.yaml) with the following Python script
(in Anaconda env with installed `qsharp`)
```py
# From local clone of https://github.com/microsoft/Quantum/tree/main/samples/chemistry/IntegralData/
import json
from qsharp.chemistry import load_broombridge, load_input_state, encode
data = load_broombridge('./Broombridge_v0.2/LiH_sto-3g.yaml')
problem = data.problem_description[0]
input_state = load_input_state('./Broombridge_v0.2/LiH_sto-3g.yaml', problem.initial_state_suggestions[0]['Label'])
print(json.dumps(encode(problem.load_fermion_hamiltonian(), input_state)))
```

# Prerequisites
Run the `bootstrap.ps1` in the root dir of this repo. It builds the required native part of the QuantumSimulator, the QIR Runtime (and other things).
Or instead, you can set the env var `BUILD_CONFIGURATION` to `Release` and run the following scripts
* Native part of the QuantumSimulator
  * [Pre-requisites](https://github.com/microsoft/qsharp-runtime/blob/main/src/Simulation/Native/prerequisites.ps1).
  * [Build](https://github.com/microsoft/qsharp-runtime/blob/main/src/Simulation/Native/build-native-simulator.ps1).
* QIR Runtime
  * [Pre-requisites](https://github.com/microsoft/qsharp-runtime/blob/main/src/Qir/Runtime/prerequisites.ps1).
  * [Build](https://github.com/microsoft/qsharp-runtime/blob/main/src/Qir/Runtime/build-qir-runtime.ps1).

# Build 
`.\build.ps1`.  
The build result is in the `.\build` folder. If during the rebuild you hit unclear errors then remove the `.\build` folder and run `.\build.ps1` again.

# Run
`.\run.ps1`.  
Can take tens of minutes (or even a few hours) on a laptop to get the result.
